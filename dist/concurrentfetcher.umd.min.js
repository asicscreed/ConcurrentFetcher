'use strict';(function(h,n){"object"===typeof exports&&"undefined"!==typeof module?n(exports):"function"===typeof define&&define.amd?define(["exports"],n):(h="undefined"!==typeof globalThis?globalThis:h||self,n(h.ConcurrentFetcher={}))})(this,function(h){class n extends Error{constructor(a,b,p){super(a);this.name="FetchError";this.url=b;this.status=p}}class t extends Error{constructor(a,b){super(a);this.name="JsonParseError";this.url=b}}class u{constructor(){this.controllers=new Map}createSignal(a){const b=
new AbortController;this.controllers.set(a,b);return b.signal}abort(a){const b=this.controllers.get(a);b&&(b.abort(),this.controllers.delete(a))}abortAll(){this.controllers.forEach(a=>a.abort());this.controllers.clear()}}class x{constructor(a){this.requests=a;this.errors=[];this.abortManager=new u}delay(a){return new Promise(b=>setTimeout(b,a))}async fetchWithRetry(a,b,p,q,d,f=0){try{const e="undefined"!==typeof Request&&a instanceof Request?a.clone():a,c=await fetch(e,b);if(!c.ok)throw new n("Fetch HTTP error! status: "+
c.status,a,c.status);let g;const k=c.headers.get("content-type");if(k&&k.includes("application/json")){const r=c.clone();try{g=await c.json()}catch(v){g=await r.text()}}else g=k&&k.includes("text/")?await c.text():await c.blob();return g}catch(e){if(0<q)return q--,f++,await this.delay(d),this.fetchWithRetry(a,b,p,q,d,f);throw e;}}async concurrentFetch({progressCallback:a}={}){const b=[];let p=0;const q=this.requests.map((d,f)=>{const {url:e,fetchOptions:c={},callback:g=null,requestId:k=null,maxRetries:r=
0,retryDelay:v=1E3,abortTimeout:w=0}=d,m=null!==k&&void 0!==k?k:f.toString();d={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json; charset: UTF-8",mode:"cors"},signal:0<w?AbortSignal.any([this.abortManager.createSignal(m),AbortSignal.timeout(w)]):this.abortManager.createSignal(m),...c};return this.fetchWithRetry(e,d,m,r,v).then(l=>{g?g(m,l,null,this.abortManager):b[f]=l}).catch(l=>{l instanceof SyntaxError&&(l=new t(l.message,e));g?g(m,null,l,this.abortManager):(this.errors.push({uniqueId:m,
url:e,error:l}),b[f]=null)}).finally(()=>{p++;a&&a(m,p,this.requests.length)})});try{return await Promise.all(q),{results:b?b.filter(d=>null!==d):[],errors:this.errors}}catch(d){return this.errors.push({uniqueId:"unknown",url:"unknown",error:d}),this.requests.forEach(f=>{var e,c;return null===(e=f.callback)||void 0===e?void 0:e.call(f,null!==(c=f.requestId)&&void 0!==c?c:"unknown",null,d,this.abortManager)}),{results:[],errors:this.errors}}}abort(a){this.abortManager.abort(a)}abortAll(){this.abortManager.abortAll()}}
h.AbortManager=u;h.ConcurrentFetcher=x;h.FetchError=n;h.JsonParseError=t});
