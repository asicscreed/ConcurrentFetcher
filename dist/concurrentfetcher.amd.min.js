'use strict';define(["exports"],function(w){class y extends Error{constructor(a,b,l){super(a);this.name="FetchError";this.url=b;this.status=l}}class z extends Error{constructor(a,b){super(a);this.name="JsonParseError";this.url=b}}class A{constructor(){this.controllers=new Map}createSignal(a){const b=new AbortController;this.controllers.set(a,b);return b.signal}abort(a){const b=this.controllers.get(a);b&&(b.abort(),this.controllers.delete(a))}abortAll(){this.controllers.forEach(a=>a.abort());this.controllers.clear()}}
class C{constructor(a){this.requests=a;this.errors=[];this.abortManager=new A}delay(a){return new Promise(b=>setTimeout(b,a))}async fetchWithRetry(a,b,l,p,f,g,h,k,m=0){let q=200;try{var r="undefined"!==typeof Request&&a instanceof Request?a.clone():a,c=await fetch(r,b);q=c.status;if(!c.ok)throw new y("Fetch HTTP error! status: "+c.status,a,c.status);let n="",t=0;c.headers&&c.headers.forEach((d,v)=>{"content-type"==v.toLowerCase()?n=d.toLowerCase():"content-length"==v.toLowerCase()&&(t=parseInt(d))});
let e;if(n.includes("application/json")){var u=c.clone();try{e=await c.json()}catch(d){e=await u.text()}}else if(n.includes("text/"))e=await c.text();else if(0<h&&t>h&&!c.bodyUsed&&c.body){const d=c.body.getReader();r=[];c=0;try{for(;;){const {done:x,value:B}=await d.read();if(x)break;r.push(B);c+=B.length;k&&k(0,0,c,t)}const v=new Uint8Array(c);u=0;for(const x of r)v.set(x,u),u+=x.length;e=v;console.log(Date.now()+" - blob is streamed: "+c+"/"+t)}finally{d.releaseLock()}}else e=await c.blob();return e}catch(n){if(this.shouldRetryRequest(q,
p,f,m))return m++,await this.delay(g),this.fetchWithRetry(a,b,l,p,f,g,h,k,m);throw n;}}async concurrentFetch({progressCallback:a}={}){const b=[];let l=0;const p=this.requests.map((f,g)=>{const {url:h,fetchOptions:k={},callback:m=null,requestId:q=null,maxRetries:r=0,statusCodesToRetry:c=[[-99],[0],[-99]],retryDelay:u=1E3,abortTimeout:n=0,cutoffAmount:t=0}=f,e=null!==q&&void 0!==q?q:g.toString();f={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json; charset: UTF-8"},signal:0<
n?AbortSignal.any([this.abortManager.createSignal(e),AbortSignal.timeout(n)]):this.abortManager.createSignal(e),...k};return this.fetchWithRetry(h,f,e,r,c,u,t,a).then(d=>{m?m(e,d,null,this.abortManager):b[g]=d}).catch(d=>{d instanceof SyntaxError&&(d=new z(d.message,h));m?m(e,null,d,this.abortManager):(this.errors.push({uniqueId:e,url:h,error:d}),b[g]=null)}).finally(()=>{l++;a&&a(e,l,this.requests.length,0,0)})});try{return await Promise.all(p),{results:b?b.filter(f=>null!==f):[],errors:this.errors}}catch(f){return this.errors.push({uniqueId:"unknown",
url:"unknown",error:f}),this.requests.forEach(g=>{var h,k;return null===(h=g.callback)||void 0===h?void 0:h.call(g,null!==(k=g.requestId)&&void 0!==k?k:"unknown",null,f,this.abortManager)}),{results:[],errors:this.errors}}}shouldRetryRequest(a,b,l,p){if(1>b-p)return!1;b=!1;for(const [f,g]of l)if(a>=f&&a<=g){b=!0;break}return b}abort(a){this.abortManager.abort(a)}abortAll(){this.abortManager.abortAll()}}w.AbortManager=A;w.ConcurrentFetcher=C;w.FetchError=y;w.JsonParseError=z});
